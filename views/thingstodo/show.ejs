<!DOCTYPE html>
<html lang="en">
<!-- Head Partial -->
<%- include('../partials/head/head.ejs', { page: thingstodo.title }) %>

    <body>
        <!-- Navbar Partial -->
        <%- include ('../partials/navbar/navbar.ejs') %>
            <h1>Things To Do Show Page</h1>

            <img src="<%= thingstodo.image %> " alt="<%= thingstodo.title %> " />
            <p>
                <%= thingstodo.title %>
            </p>
            <p>
                <%= thingstodo.description %>
            </p>

            <!-- REVIEW AREA  -->
            <h1>REVIEWS</h1>
            <% reviews.forEach(allReview=> { %>
                <p>
                    <%= allReview.rating %>/5
                </p>
                <p>
                    <%= allReview.content %>
                </p>
                <p>
                    <%= new Date(allReview.createdAt).toLocaleString() %>
                </p>

                <!-- EACH REVIEW MODAL -->
                <div class="modal fade" id="allReviewModal-<%= allReview._id %>" tabindex="-1"
                    aria-labelledby="allReviewModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="allReviewModalLabel">Edit Review!</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                    aria-label="Close"></button>
                            </div>
                            <div class="modal-body">
                                <div class="container">
                                    <form action="/reviews/<%= allReview._id %>?_method=PUT" method="POST">
                                        <div class="mb-3">
                                            <label>Rating</label>
                                            <div>
                                                <input type="number" name="rating" min="1" max="5" placeholder="1-5"
                                                    value="<%= allReview.rating %>" required />
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label>Content</label>
                                            <div>
                                                <input type="text" name="content" minlength="1" maxlength="100"
                                                    placeholder="What do you think?" value="<%= allReview.content %> "
                                                    required />
                                            </div>
                                        </div>

                                        <!-- Here is our hidden input to provide the thingstodo id -->
                                        <input type="hidden" name="thingstodo" value="<%= thingstodo._id %>" />

                                        <div class="modal-footer">
                                            <button type="submit" class="btn btn-primary">
                                                Submit
                                            </button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="review-edit-delete">
                    <button type="button" class="toggle-modal" data-bs-toggle="modal"
                        data-bs-target="#allReviewModal-<%= allReview._id %>">
                        Edit
                    </button>

                    <!-- DELETE trigger modal -->
                    <button type="button" class="toggle-modal" data-bs-toggle="modal"
                        data-bs-target="#deleteModal-<%= allReview._id %>">
                        Delete
                    </button>
                </div>

                <!-- DELETE Modal -->
                <div class="modal fade" id="deleteModal-<%= allReview._id %>" tabindex="-1"
                    aria-labelledby="deleteModalLabel" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="deleteModalLabel">Are you sure you want to delete this
                                    review?</h5>
                            </div>
                            <div class="modal-body">
                                " <%= allReview.content %> "
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <form action="/reviews/<%= allReview._id %>?_method=DELETE" method="POST">
                                    <button class="btn btn-primary">
                                        Confirm
                                    </button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <% }) %>

                    <!-- Button trigger modal -->
                    <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#reviewModal">
                        Create Review!
                    </button>

                    <!-- REVIEW MODAL -->
                    <div class="modal fade" id="reviewModal" tabindex="-1" aria-labelledby="reviewModalLabel"
                        aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title" id="reviewModalLabel">Create Review!</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <div class="container">
                                        <form action="/reviews?redirect=thingstodo%2F<%= thingstodo._id %>"
                                            method="POST">
                                            <div class="mb-3">
                                                <label>Rating</label>
                                                <div>
                                                    <input type="number" name="rating" min="1" max="5" placeholder="1-5"
                                                        required />
                                                </div>
                                            </div>
                                            <div class="mb-3">
                                                <label>Content</label>
                                                <div>
                                                    <input type="text" name="content" minlength="1" maxlength="100"
                                                        placeholder="What do you think?" required />
                                                </div>
                                            </div>

                                            <!-- Here is our hidden input to provide the thingstodo id -->
                                            <input type="hidden" name="thingstodo" value="<%= thingstodo._id %>" />

                                            <!-- Here is our hidden input to provide the user id -->
                                            <!-- <input type="hidden" name="user" value="<%= user._id %>" /> -->

                                            <div class="modal-footer">
                                                <button type="submit" class="btn btn-primary">Submit</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
    </body>

</html>